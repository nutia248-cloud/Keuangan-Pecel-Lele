<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI Keuangan Pecel Lele - Complete</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* --- CSS Global Reset dan Variabel --- */
        :root {
            --dark-bg: #1c2128;
            --sidebar-bg: #11151a;
            --text-light: #f1f1f1;
            --primary-color-green: #2ecc71;
            --secondary-color-red: #e74c3c;
            --tertiary-color-blue: #3498db;
            --content-bg: #f1f1f1;
            --text-dark: #333;
            --text-secondary: #95a5a6;
            --input-dark-green: #1a433f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-dark); 
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar, .login-container {
            color: var(--text-light); 
        }

        /* --- TATA LETAK UTAMA --- */
        .main-layout { display: flex; width: 100%; }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 200px;
            background-color: var(--sidebar-bg);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            color: var(--text-light); 
        }

        .sidebar .logo {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color-green);
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .sidebar .menu a {
            display: block;
            text-decoration: none;
            color: var(--text-light);
            padding: 12px 20px;
            width: 100%;
            transition: background-color 0.3s;
        }

        .sidebar .menu a:hover,
        .sidebar .menu a.active {
            background-color: var(--primary-color-green);
            color: var(--sidebar-bg);
        }
        
        .sidebar .logout-section {
            margin-top: auto;
            padding: 20px;
            width: 100%;
            text-align: center;
            border-top: 1px solid #333;
        }
        
        .admin-info {
            text-align: center;
            margin-top: 5px;
            font-size: 12px;
        }
        .admin-info p:first-child { color: var(--text-secondary); margin-bottom: 2px; }
        .sidebar .logout-section a { color: var(--text-light); text-decoration: none; font-size: 14px; display: block; padding: 10px 0; margin-bottom: 5px; }

        /* --- KONTEN UTAMA --- */
        .content { 
            flex-grow: 1; 
            padding: 30px; 
            background-color: var(--content-bg);
            color: var(--text-dark);
        }
        .content header h1 { padding-bottom: 15px; margin-bottom: 20px; color: var(--text-dark); }
        
        /* --- DASHBOARD STYLE --- */
        .dashboard-container { 
            background-color: var(--dark-bg);
            color: var(--text-light);
            padding: 30px;
            border-radius: 10px;
        }

        /* --- CARD STYLE --- */
        .summary-cards { display: flex; gap: 20px; margin-bottom: 40px; }
        .card { flex: 1; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
        .card h3 { font-size: 14px; margin-bottom: 5px; }
        .card .amount { font-size: 30px; font-weight: bold; margin-bottom: 5px; }
        .card .detail { font-size: 12px; opacity: 0.8; }
        .card.green { background-color: var(--primary-color-green); color: var(--sidebar-bg); }
        .card.red { background-color: var(--secondary-color-red); color: var(--text-light); }
        .card.blue { background-color: var(--tertiary-color-blue); color: var(--text-light); }

        /* --- CHART & ALERT STYLE --- */
        .chart-container { width: 100%; background-color: var(--dark-bg); border-radius: 8px; margin-bottom: 20px; padding: 20px; }
        .stock-alert { background-color: #3d4652; padding: 15px; border-radius: 8px; margin-top: 20px; margin-bottom: 30px; border-left: 5px solid var(--secondary-color-red); }
        .stock-alert .alert-item { display: flex; justify-content: space-between; align-items: center; margin-top: 5px; padding: 8px; background-color: rgba(231, 76, 60, 0.1); border-radius: 4px; }
        .stock-alert .status { background-color: var(--secondary-color-red); padding: 2px 8px; border-radius: 3px; font-size: 10px; font-weight: bold; }
        
        .top-menu-list .menu-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 15px; 
            margin-bottom: 8px; 
            background-color: rgba(46, 204, 113, 0.2);
            border-radius: 5px; 
        }
        .top-menu-list .menu-row:last-child {
            margin-bottom: 0;
        }

        .top-menu-list .count { 
            color: var(--sidebar-bg); 
            background-color: var(--primary-color-green); 
            font-weight: bold; 
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 14px;
        }

        /* --- TRANSAKSI STYLE --- */
        .transaksi-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .menu-list, .cart-history { 
            padding: 15px; 
            border-radius: 8px; 
        }
        .menu-list h2, .cart-history h2 { margin-bottom: 15px; color: var(--text-dark); }
        
        .menu-grid { display: flex; flex-wrap: wrap; justify-content: space-between; }
        .menu-card { 
            background-color: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            width: 48%; 
            border: 2px solid var(--primary-color-green); 
        }
        .menu-card h4 { color: var(--text-dark); margin-bottom: 5px; }
        .menu-card p { color: var(--secondary-color-red); font-weight: bold; margin-bottom: 10px;}

        .menu-card button { 
            width: 80px; 
            margin: 0; 
            padding: 5px; 
            background-color: var(--secondary-color-red); 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            align-self: flex-end; 
        }
        
        /* Keranjang Items */
        .keranjang .cart-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 10px; 
            padding: 10px;
            background-color: #f8f8f8; 
            border-radius: 5px;
            border-left: 3px solid var(--primary-color-green);
        }
        .keranjang .item-info { flex-grow: 1; }
        .keranjang .item-info span:first-child { font-weight: bold; color: var(--text-dark); }
        .keranjang .item-info span:last-child { display: block; font-size: 12px; color: #555; }
        
        .keranjang .item-price-total { font-weight: bold; color: var(--primary-color-green); }

        .keranjang .remove-btn {
            background-color: var(--secondary-color-red);
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 10px;
        }

        .total { 
            font-size: 18px; 
            font-weight: bold; 
            padding-top: 15px; 
            border-top: 2px solid var(--text-dark); 
            margin-top: 20px; 
            display: flex; 
            justify-content: space-between;
            color: var(--text-dark); 
        }
        .total span:last-child {
            font-size: 24px;
            color: var(--primary-color-green);
        }

        .bayar-button {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background-color: var(--secondary-color-red) !important;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .riwayat h2 { margin-top: 30px; }
        .riwayat table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .riwayat th, .riwayat td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; color: var(--text-dark); }
        .riwayat th { background-color: #eee; }
        
        /* --- INVENTORI STYLE --- */
        .stok-table {
            background-color: white; 
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .stok-table h2 {
            color: var(--text-dark);
            margin-bottom: 15px;
        }
        .stok-table table { 
            width: 100%;
            border-collapse: collapse; 
            margin-top: 15px; 
        }
        .stok-table th, .stok-table td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #ddd; 
            color: var(--text-dark);
        }
        .stok-table th { 
            background-color: #f1f1f1; 
            font-weight: bold;
            border-top: 1px solid #ddd;
        }

        .input-stok-button {
            background-color: var(--tertiary-color-blue) !important;
            color: white; 
            border: none; 
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .input-stok-button:hover {
            background-color: #2980b9 !important;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-indicator.ok {
            background-color: var(--primary-color-green);
        }
        .status-indicator.low {
            background-color: var(--secondary-color-red);
        }
        .status-text {
             font-weight: bold; 
             font-size: 12px;
        }

        /* --- INPUT STOK FORM STYLE --- */
        .input-stok-container {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .input-stok-container h2 {
            color: var(--text-dark);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-dark);
        }
        
        .form-group select,
        .form-group input[type="number"],
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group select:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--tertiary-color-blue);
        }
        
        .btn-primary {
            background-color: var(--primary-color-green);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 10px;
        }
        
        .btn-primary:hover {
            background-color: #27ae60;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .message-success {
            background-color: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }
        
        .message-error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 4px solid #dc3545;
        }
        
        /* --- LAPORAN KEUANGAN STYLE --- */
        .laporan-container {
            background-color: white; 
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            color: var(--text-dark);
        }

        .laporan-container h2 {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .laporan-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 25px;
            gap: 10px;
        }

        .export-button-excel {
            background-color: var(--primary-color-green);
            color: white; 
            border: none; 
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .laporan-laba-rugi {
            margin-bottom: 30px;
            padding: 15px 0;
            border: 1px solid #ddd;
            border-left: none;
            border-right: none;
        }
        
        .laporan-laba-rugi h3 {
            font-size: 14px;
            color: var(--text-dark);
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
            font-weight: bold;
        }

        .laporan-laba-rugi .item-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 14px;
        }
        
        .laporan-laba-rugi .total-pemasukan .amount,
        .laporan-laba-rugi .total-pengeluaran .amount,
        .laporan-laba-rugi .laba-bersih-row .amount {
            font-weight: bold;
            font-size: 16px;
        }

        .laporan-laba-rugi .total-pemasukan .amount {
            color: var(--primary-color-green);
        }

        .laporan-laba-rugi .total-pengeluaran .amount {
            color: var(--secondary-color-red);
        }
        
        .laporan-laba-rugi .laba-bersih-row {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 2px solid var(--text-dark);
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .laporan-laba-rugi .laba-bersih-row .amount {
            color: var(--primary-color-green);
            font-size: 22px;
        }
        
        .laporan-laba-rugi .margin-row {
            text-align: right;
            font-size: 14px;
            margin-top: 5px;
        }
        
        #laporan .chart-container {
            background-color: transparent !important;
            padding: 0 !important;
            margin-top: 30px;
        }

        .page-content { display: none; width: 100%; }
        #dashboard.active, #transaksi.active, #inventori.active, #laporan.active { display: block; }
        
        /* --- TAMPILAN LOGIN --- */
        #login {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--dark-bg);
            z-index: 100;
        }
        
        .login-container {
            width: 350px; 
            padding: 40px; 
            background-color: var(--sidebar-bg); 
            border-radius: 10px; 
            text-align: left;
        }
        
        .login-container h1 { font-size: 18px; margin-bottom: 5px; text-align: center; color: var(--text-light); }
        .login-container h2 { font-size: 30px; color: var(--primary-color-green); margin-bottom: 25px; text-align: center; }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 14px; font-weight: bold; color: var(--text-light); }
        
        input[type="text"], input[type="password"] {
            width: 100%; 
            padding: 15px; 
            margin: 0; 
            border: none; 
            border-radius: 5px;
            background-color: var(--input-dark-green); 
            color: var(--text-light); 
            font-size: 16px;
        }

        .login-button { 
            width: 100%; 
            margin-top: 25px; 
            padding: 15px;
            background-color: var(--primary-color-green); 
            color: var(--text-light); 
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .login-button:hover { background-color: #27ae60; }

        .firebase-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 11px;
            z-index: 1000;
        }
        .firebase-status.connected { background-color: rgba(46, 204, 113, 0.8); }
        .firebase-status.error { background-color: rgba(231, 76, 60, 0.8); }
    </style>
</head>

<body>
    
    <div id="login" class="page-content active">
        <div class="login-container">
            <h1>SISTEM INFORMASI KEUANGAN</h1>
            <h2>PECEL LELE</h2>
            
            <form class="login-form" id="loginForm">
                <div class="input-group">
                    <label for="username-input">Username</label>
                    <input type="text" id="username-input" value="admin" required> 
                </div>
                <div class="input-group">
                    <label for="password-input">Password</label>
                    <input type="password" id="password-input" value="123" required>
                </div>
                
                <button type="submit" class="login-button" id="loginButton">LOGIN</button>
            </form>
        </div>
    </div>

    <div class="main-layout" id="app-container" style="display: none;">
        <aside class="sidebar">
            <div class="logo">SISTEM INFORMASI KEUANGAN</div>
            <div class="logo">PECEL LELE</div>
            <nav class="menu">
                <a href="#" onclick="showPage('dashboard')" id="nav-dashboard" class="active">Dashboard</a>
                <a href="#" onclick="showPage('transaksi')" id="nav-transaksi">Transaksi</a>
                <a href="#" onclick="showPage('inventori')" id="nav-inventori">Inventori</a>
                <a href="#" onclick="showPage('laporan')" id="nav-laporan">Laporan</a>
            </nav>
            <div class="logout-section">
                <a href="#" onclick="doLogout()">Logout</a>
            </div>
            <div class="admin-info">
                <p>Admin Utama</p>
                <p>Admin</p>
            </div>
        </aside>

        <div class="content">

            <div id="dashboard" class="page-content active">
                <header><h1>DASHBOARD</h1></header>
                
                <div class="dashboard-container">
                    <section class="summary-cards">
                        <div class="card green">
                            <h3>Pemasukan Hari Ini</h3>
                            <div class="amount" id="dashboard-pemasukan">Rp. 0</div>
                            <div class="detail" id="dashboard-pemasukan-detail">Naik 15% vs Kemarin</div>
                        </div>
                        <div class="card red">
                            <h3>Pengeluaran Hari Ini</h3>
                            <div class="amount" id="dashboard-pengeluaran">Rp. 1.500.000</div> 
                            <div class="detail">Bahan Baku</div>
                        </div>
                        <div class="card blue">
                            <h3>Laba Bersih</h3>
                            <div class="amount" id="dashboard-laba">Rp. 0</div>
                            <div class="detail" id="dashboard-margin">Margin 0%</div>
                        </div>
                    </section>

                    <section class="charts">
                        <h3>Trend Penjualan 7 Hari</h3>
                        <div class="chart-container" style="height: 300px;"><canvas id="lineChart"></canvas></div>
                        
                        <h3>Distribusi Penjualan</h3>
                        <div class="chart-container" style="max-width: 400px; margin: 20px auto;"><canvas id="pieChart"></canvas></div>
                    </section>
                    
                    <section class="stock-alert" id="stock-alert-section">
                        <h3 style="color: yellow; margin-bottom: 10px;">‚ö†Ô∏è Stock Alert</h3>
                        <div id="stock-alert-items">
                            <p style="color: rgba(241, 241, 241, 0.7);">Memuat data stok...</p>
                        </div>
                    </section>
                    
                    <section class="top-menu-list">
                        <h3>Top Menu Hari Ini</h3>
                        <div class="menu-row">
                            <span>Pecel Lele Biasa</span>
                            <span class="count">45 Porsi</span>
                        </div>
                        <div class="menu-row">
                            <span>Es Teh</span>
                            <span class="count">60 Gelas</span>
                        </div>
                        <div class="menu-row">
                            <span>Paket Komplit</span>
                            <span class="count">30 Porsi</span>
                        </div>
                    </section>
                </div>
            </div>
            
            <div id="transaksi" class="page-content">
                <header><h1>TRANSAKSI</h1></header>
                
                <div class="transaksi-grid">
                    
                    <section class="menu-list">
                        <h2>Daftar Menu</h2>
                        <div class="menu-grid">
                            <div class="menu-card">
                                <h4>Pecel Lele Biasa</h4><p>Rp. 25.000</p>
                                <button onclick="tambahKeKeranjang('Pecel Lele Biasa', 25000)">Tambah</button>
                            </div>
                            <div class="menu-card">
                                <h4>Pecel Lele Jumbo</h4><p>Rp. 35.000</p>
                                <button onclick="tambahKeKeranjang('Pecel Lele Jumbo', 35000)">Tambah</button>
                            </div>
                            <div class="menu-card">
                                <h4>Paket Komplit</h4><p>Rp. 40.000</p>
                                <button onclick="tambahKeKeranjang('Paket Komplit', 40000)">Tambah</button>
                            </div>
                            <div class="menu-card">
                                <h4>Es Teh</h4><p>Rp. 5.000</p>
                                <button onclick="tambahKeKeranjang('Es Teh', 5000)">Tambah</button>
                            </div>
                            <div class="menu-card">
                                <h4>Teh Panas</h4><p>Rp. 3.000</p>
                                <button onclick="tambahKeKeranjang('Teh Panas', 3000)">Tambah</button>
                            </div>
                            <div class="menu-card">
                                <h4>Es Jeruk</h4><p>Rp. 7.000</p>
                                <button onclick="tambahKeKeranjang('Es Jeruk', 7000)">Tambah</button>
                            </div>
                        </div>
                    </section>
                    
                    <aside class="cart-history">
                        
                        <section class="keranjang">
                            <h2 style="margin-bottom: 25px;">üõí Keranjang</h2>
                            <div id="keranjang-items"></div>
                            
                            <div class="total" id="keranjang-total">
                                TOTAL:
                                <span>Rp. 0</span>
                            </div>
                            
                            <input type="hidden" id="total-bayar-input" value="0">
                            
                            <button type="button" class="bayar-button" onclick="handlePembayaran()">Bayar</button>
                        </section>
                        
                        <section class="riwayat">
                            <h2>Riwayat Transaksi</h2>
                            <table style="width: 100%; font-size: 12px; text-align: left;">
                                <thead>
                                    <tr>
                                        <th>ID</th><th>Tanggal</th><th>Items</th><th>Total</th><th>Kasir</th>
                                    </tr>
                                </thead>
                                <tbody id="riwayat-transaksi-body"></tbody>
                            </table>
                            
                            <p id="riwayat-kosong-message" style="text-align: center; margin-top: 15px; color: #555;">
                                Belum ada transaksi yang tercatat hari ini.
                            </p>
                        </section>
                        
                    </aside>
                </div>
            </div>

            <div id="inventori" class="page-content">
                <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1>INVENTORI</h1>
                </header>
                
                <section id="daftar-stok-section" class="stok-table">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h2>Daftar Stok</h2>
                        <button class="input-stok-button" onclick="toggleInputStok()">Input Stok</button>
                    </div>
                    
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Nama Bahan</th>
                                <th>Stok</th>
                                <th>Satuan</th>
                                <th>Min</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #999;">Memuat data inventori...</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
                
                <section id="input-stok-section" class="input-stok-container" style="display: none;">
                    <h2>‚ûï Input Stok Baru</h2>

                    <form id="inputStokForm">
                        <div class="form-group">
                            <label for="namaBahan">Nama Bahan:</label>
                            <select id="namaBahan" required>
                                <option value="">-- Pilih Bahan --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="jumlahStok">Jumlah Stok:</label>
                            <input type="number" id="jumlahStok" min="1" required>
                        </div>

                        <div class="form-group">
                            <label for="satuan">Satuan:</label>
                            <input type="text" id="satuan" value="" disabled> 
                        </div>
                        
                        <div class="form-group">
                            <label for="jenisTransaksi">Jenis Transaksi:</label>
                            <select id="jenisTransaksi" required>
                                <option value="tambah">Tambah Stok</option>
                                <option value="kurang">Kurangi Stok (Adjustment)</option>
                            </select>
                        </div>

                        <button type="submit" class="btn-primary">Simpan Stok</button>
                        <button type="button" class="btn-secondary" onclick="toggleInputStok()">Batal</button>
                    </form>

                    <p id="messageArea" style="display:none; margin-top: 15px;"></p>
                </section>
            </div>
            
            <div id="laporan" class="page-content">
                <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1>LAPORAN KEUANGAN</h1>
                </header>
                
                <div class="laporan-container">
                    
                    <div class="laporan-header">
                        <button class="export-button-excel" id="export-excel-button">Export Excel</button>
                    </div>

                    <h2>LAPORAN LABA RUGI</h2>
                    <p style="text-align: center; margin-bottom: 20px; font-size: 14px;">Periode : Hari Ini (<span id="laporan-tanggal">04 November 2025</span>)</p>

                    <div class="laporan-laba-rugi">
                        <h3>PEMASUKAN:</h3>
                        <div class="item-row"><span>Penjualan Pecel Lele</span><span id="laporan-jual-lele">Rp. 0</span></div>
                        <div class="item-row"><span>Penjualan Minuman</span><span id="laporan-jual-minuman">Rp. 0</span></div>
                        
                        <div class="item-row total-pemasukan" style="margin-top: 10px; border-top: 1px solid #ccc; padding-top: 5px;">
                            <span><strong>Total Pemasukan:</strong></span>
                            <span class="amount" id="laporan-total-pemasukan">Rp. 0</span>
                        </div>
                        
                        <h3>PENGELUARAN:</h3>
                        <div class="item-row"><span>Bahan Baku</span><span id="laporan-pengeluaran-bahan">Rp. 600.000</span></div>
                        <div class="item-row"><span>Gas</span><span id="laporan-pengeluaran-gas">Rp. 100.000</span></div>
                        <div class="item-row"><span>Operasional</span><span id="laporan-pengeluaran-operasional">Rp. 250.000</span></div>
                        
                        <div class="item-row total-pengeluaran" style="margin-top: 10px; border-top: 1px solid #ccc; padding-top: 5px;">
                            <span><strong>Total Pengeluaran:</strong></span>
                            <span class="amount" id="laporan-total-pengeluaran">Rp. 950.000</span>
                        </div>
                        
                        <div class="laba-bersih-row">
                            <span><strong>LABA BERSIH:</strong></span>
                            <span class="amount" id="laporan-laba-bersih">Rp. 0</span>
                        </div>
                        <div class="margin-row">
                            <span id="laporan-margin-row">Margin: <strong>0%</strong></span>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="height: 300px;"><canvas id="barChart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <div id="firebase-status" class="firebase-status">Firebase: Connecting...</div>
    
    <script>
        // --- KONFIGURASI FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCizK1NL9L1jARyHX9fwNeOZ6qeJxpqivk",
            authDomain: "keuangann-umkm-default.firebaseapp.com",
            databaseURL: "https://keuangann-umkm-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "keuangann-umkm-default",
            storageBucket: "keuangann-umkm-default.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Inisialisasi Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            
            // Test koneksi
            database.ref('.info/connected').on('value', (snapshot) => {
                const statusEl = document.getElementById('firebase-status');
                if (snapshot.val() === true) {
                    statusEl.textContent = 'Firebase: Connected ‚úì';
                    statusEl.className = 'firebase-status connected';
                    console.log('Firebase connected successfully');
                } else {
                    statusEl.textContent = 'Firebase: Disconnected';
                    statusEl.className = 'firebase-status error';
                    console.log('Firebase disconnected');
                }
            });
        } catch (error) {
            console.error('Firebase initialization error:', error);
            document.getElementById('firebase-status').textContent = 'Firebase: Error - ' + error.message;
            document.getElementById('firebase-status').className = 'firebase-status error';
        }

        // --- VARIABEL GLOBAL DAN DATA APLIKASI ---
        let lineChartInstance = null;
        let pieChartInstance = null;
        let barChartInstance = null;
        
        let keranjang = [];
        let riwayatTransaksi = [];
        let inventoryData = [];

        // Data Dashboard (Statik untuk Chart)
        const penjualanDataStatik = [750000, 650000, 1500000, 2000000, 2500000, 2400000, 2800000];
        const penjualanLabelsStatik = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
        const kategoriDataStatik = [45, 35, 20];
        const kategoriLabelsStatik = ['Pecel Lele', 'Paket', 'Minuman'];
        
        // Data Laporan Statik (Pengeluaran - Hardcode sementara)
        const pengeluaranHarian = 1500000;
        const pengeluaranDetail = {
            'bahanBaku': 1000000,
            'gas': 150000,
            'operasional': 350000
        };

        // --- FUNGSI UTILITAS ---
        function formatRupiah(number) {
            return 'Rp. ' + new Intl.NumberFormat('id-ID').format(number);
        }

        function getCurrentDate() {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return new Date().toLocaleDateString('id-ID', options);
        }

        // --- FUNGSI EKSPORT (Fungsi baru untuk Export Excel/CSV) ---
        function exportLabaRugiToCSV() {
            const tanggal = document.getElementById('laporan-tanggal').textContent;
            // Menghapus 'Rp. ' dan titik pemisah ribuan agar menjadi angka murni
            const cleanRupiah = (id) => document.getElementById(id).textContent.replace('Rp. ', '').replace(/\./g, '');
            
            const totalPemasukan = cleanRupiah('laporan-total-pemasukan');
            const totalPengeluaran = cleanRupiah('laporan-total-pengeluaran');
            const labaBersih = cleanRupiah('laporan-laba-bersih');
            const margin = document.getElementById('laporan-margin-row').querySelector('strong').textContent.replace('%', '');
            
            const pemasukanJualLele = cleanRupiah('laporan-jual-lele');
            const pemasukanJualMinuman = cleanRupiah('laporan-jual-minuman');
            const pengeluaranBahan = cleanRupiah('laporan-pengeluaran-bahan');
            const pengeluaranGas = cleanRupiah('laporan-pengeluaran-gas');
            const pengeluaranOperasional = cleanRupiah('laporan-pengeluaran-operasional');

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Laporan Laba Rugi Pecel Lele\n";
            csvContent += `Periode,${tanggal}\n\n`;
            
            // Header
            csvContent += "Deskripsi,Jumlah\n";
            
            // Pemasukan
            csvContent += "PEMASUKAN,\n";
            csvContent += `Penjualan Pecel Lele,${pemasukanJualLele}\n`;
            csvContent += `Penjualan Minuman,${pemasukanJualMinuman}\n`;
            csvContent += `Total Pemasukan,${totalPemasukan}\n\n`;
            
            // Pengeluaran
            csvContent += "PENGELUARAN,\n";
            csvContent += `Bahan Baku,${pengeluaranBahan}\n`;
            csvContent += `Gas,${pengeluaranGas}\n`;
            csvContent += `Operasional,${pengeluaranOperasional}\n`;
            csvContent += `Total Pengeluaran,${totalPengeluaran}\n\n`;
            
            // Laba Bersih
            csvContent += "LABA BERSIH,\n";
            csvContent += `LABA BERSIH,${labaBersih}\n`;
            csvContent += `Margin,${margin}\n`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Laporan_Laba_Rugi_${tanggal.replace(/\s/g, '_')}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- FUNGSI FIREBASE: INVENTORY ---
        function loadInventoryFromFirebase() {
            if (!database) {
                console.error('Database not initialized');
                return;
            }
            
            database.ref('inventory').on('value', (snapshot) => {
                inventoryData = [];
                const data = snapshot.val();
                
                console.log('Inventory data loaded:', data);
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        inventoryData.push({
                            id: key,
                            ...data[key]
                        });
                    });
                }
                
                updateInventoryTable();
                updateStockAlert();
                populateNamaBahanDropdown();
            }, (error) => {
                console.error('Error loading inventory:', error);
                document.getElementById('inventory-table-body').innerHTML = 
                    '<tr><td colspan="5" style="text-align: center; color: red;">Error loading data: ' + error.message + '</td></tr>';
            });
        }

        function updateInventoryTable() {
            const tbody = document.getElementById('inventory-table-body');
            
            if (inventoryData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">Tidak ada data inventori</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            inventoryData.forEach(item => {
                const isLow = item.stok < item.min;
                const statusClass = isLow ? 'low' : 'ok';
                const statusText = isLow ? 'LOW' : 'OK';
                const statusColor = isLow ? 'var(--secondary-color-red)' : 'var(--primary-color-green)';
                
                const row = `
                    <tr>
                        <td>${item.nama}</td>
                        <td>${item.stok}</td>
                        <td>${item.satuan}</td>
                        <td>${item.min}</td>
                        <td>
                            <div style="display: flex; align-items: center;">
                                <span class="status-indicator ${statusClass}"></span> 
                                <span class="status-text" style="color: ${statusColor};">${statusText}</span>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function updateStockAlert() {
            const alertContainer = document.getElementById('stock-alert-items');
            const lowStockItems = inventoryData.filter(item => item.stok < item.min);
            
            if (lowStockItems.length === 0) {
                alertContainer.innerHTML = '<p style="color: rgba(241, 241, 241, 0.7);">Semua stok dalam kondisi baik ‚úì</p>';
                return;
            }
            
            alertContainer.innerHTML = '';
            lowStockItems.forEach(item => {
                const alertHtml = `
                    <div class="alert-item">
                        <span>${item.nama}: ${item.stok} ${item.satuan}</span>
                        <span class="status">LOW STOCK</span>
                    </div>
                `;
                alertContainer.innerHTML += alertHtml;
            });
        }

        function populateNamaBahanDropdown() {
            const select = document.getElementById('namaBahan');
            select.innerHTML = '<option value="">-- Pilih Bahan --</option>';
            
            inventoryData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.nama;
                option.dataset.satuan = item.satuan;
                select.appendChild(option);
            });
        }

        function toggleInputStok() {
            const daftarSection = document.getElementById('daftar-stok-section');
            const inputSection = document.getElementById('input-stok-section');
            
            if (inputSection.style.display === 'none') {
                daftarSection.style.display = 'none';
                inputSection.style.display = 'block';
                document.getElementById('inputStokForm').reset();
                document.getElementById('satuan').value = ''; // Reset satuan field
                document.getElementById('messageArea').style.display = 'none';
            } else {
                daftarSection.style.display = 'block';
                inputSection.style.display = 'none';
            }
        }

        function showMessage(text, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.textContent = text;
            messageArea.className = type === 'success' ? 'message-success' : 'message-error';
            messageArea.style.display = 'block';
        }

        // --- FUNGSI FIREBASE: TRANSAKSI ---
        function loadTransaksiFromFirebase() {
            if (!database) {
                console.error('Database not initialized');
                return;
            }
            
            database.ref('transaksi').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                riwayatTransaksi = [];
                const data = snapshot.val();
                
                console.log('Transaction data loaded:', data);
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        riwayatTransaksi.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    
                    // Sort by timestamp descending
                    riwayatTransaksi.sort((a, b) => b.timestamp - a.timestamp);
                }
                
                updateDashboardSummary();
                tampilkanRiwayat();
                updateLaporanKeuangan();
            }, (error) => {
                console.error('Error loading transactions:', error);
            });
        }

        function saveTransaksiToFirebase(transaksi) {
            if (!database) {
                console.error('Database not initialized');
                return Promise.reject(new Error('Database not initialized'));
            }
            
            const newTransaksiRef = database.ref('transaksi').push();
            console.log('Saving transaction:', transaksi);
            
            return newTransaksiRef.set({
                ...transaksi,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                console.log('Transaction saved successfully');
            }).catch((error) => {
                console.error('Error saving transaction:', error);
                throw error;
            });
        }

        // --- FUNGSI DASHBOARD DINAMIS ---
        function updateDashboardSummary() {
            const pemasukanEl = document.getElementById('dashboard-pemasukan');
            const pengeluaranEl = document.getElementById('dashboard-pengeluaran');
            const labaEl = document.getElementById('dashboard-laba');
            const marginEl = document.getElementById('dashboard-margin');
            const pengeluaranDetailEl = document.getElementById('dashboard-pemasukan-detail');

            // Filter transaksi hari ini
            const today = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            const transaksiHariIni = riwayatTransaksi.filter(t => t.tanggal === today);
            
            const totalPemasukan = transaksiHariIni.reduce((sum, t) => sum + t.total, 0);
            const labaBersih = totalPemasukan - pengeluaranHarian;
            const margin = (totalPemasukan > 0) ? (labaBersih / totalPemasukan) * 100 : 0;

            pemasukanEl.textContent = formatRupiah(totalPemasukan);
            pengeluaranEl.textContent = formatRupiah(pengeluaranHarian);
            
            if (labaBersih >= 0) {
                labaEl.textContent = formatRupiah(labaBersih);
                labaEl.style.color = 'var(--text-light)';
            } else {
                labaEl.textContent = `(${formatRupiah(Math.abs(labaBersih))})`;
                labaEl.style.color = '#ffdd57';
            }
            
            marginEl.textContent = `Margin ${margin.toFixed(2)}%`;

            const pemasukanKemarin = 1500000;
            const selisih = totalPemasukan - pemasukanKemarin;
            const persen = (pemasukanKemarin > 0) ? ((selisih / pemasukanKemarin) * 100) : 0;

            if (totalPemasukan > 0) {
                pengeluaranDetailEl.textContent = `${selisih >= 0 ? 'Naik' : 'Turun'} ${Math.abs(persen).toFixed(2)}% vs Kemarin`;
            } else {
                pengeluaranDetailEl.textContent = 'Belum ada transaksi hari ini';
            }
        }

        // --- FUNGSI CHART ---
        function renderLineChart() {
            if (lineChartInstance) lineChartInstance.destroy();
            const ctx = document.getElementById('lineChart').getContext('2d');
            lineChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: penjualanLabelsStatik,
                    datasets: [{
                        label: 'Penjualan',
                        data: penjualanDataStatik,
                        borderColor: 'rgb(46, 204, 113)',
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) { return 'Rp ' + (value / 1000) + 'K'; },
                                color: 'rgba(241, 241, 241, 0.7)'
                            },
                            grid: { color: 'rgba(241, 241, 241, 0.1)' }
                        },
                        x: {
                            ticks: { color: 'rgba(241, 241, 241, 0.7)' },
                            grid: { color: 'rgba(241, 241, 241, 0.1)' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function renderPieChart() {
            if (pieChartInstance) pieChartInstance.destroy();
            const ctx = document.getElementById('pieChart').getContext('2d');
            pieChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: kategoriLabelsStatik,
                    datasets: [{
                        data: kategoriDataStatik,
                        backgroundColor: ['#2ecc71', '#3498db', '#e74c3c'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top', labels: { color: 'rgba(241, 241, 241, 0.9)' } } }
                }
            });
        }

        function renderBarChart() {
            if (barChartInstance) barChartInstance.destroy();
            const ctx = document.getElementById('barChart').getContext('2d');
            barChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: penjualanLabelsStatik,
                    datasets: [{
                        label: 'Penjualan Harian',
                        data: penjualanDataStatik,
                        backgroundColor: '#2ecc71',
                        borderColor: '#2ecc71',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: function(value) { return 'Rp ' + (value / 1000) + 'K'; }, color: '#333' }
                        },
                        x: {
                            ticks: { color: '#333' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- FUNGSI TRANSAKSI ---
        function tambahKeKeranjang(nama, harga) {
            const existingItem = keranjang.find(item => item.nama === nama);
            if (existingItem) {
                existingItem.qty++;
                existingItem.subtotal = existingItem.qty * existingItem.harga;
            } else {
                keranjang.push({ nama, harga, qty: 1, subtotal: harga });
            }
            updateKeranjangUI();
        }

        function hapusDariKeranjang(index) {
            keranjang.splice(index, 1);
            updateKeranjangUI();
        }

        function updateKeranjangUI() {
            const keranjangDiv = document.getElementById('keranjang-items');
            const totalDiv = document.getElementById('keranjang-total');
            const totalInput = document.getElementById('total-bayar-input');
            let total = 0;

            keranjangDiv.innerHTML = '';
            
            keranjang.forEach((item, index) => {
                total += item.subtotal;
                const itemHtml = `
                    <div class="cart-item">
                        <div class="item-info">
                            <span>${item.nama} (x${item.qty})</span>
                            <span>${formatRupiah(item.harga)}</span>
                        </div>
                        <span class="item-price-total">${formatRupiah(item.subtotal)}</span>
                        <button class="remove-btn" onclick="hapusDariKeranjang(${index})">Hapus</button>
                    </div>
                `;
                keranjangDiv.innerHTML += itemHtml;
            });

            totalDiv.querySelector('span').textContent = formatRupiah(total);
            totalInput.value = total;
        }

        function handlePembayaran() {
            const totalBayar = document.getElementById('total-bayar-input').value;
            
            if (Number(totalBayar) > 0 && keranjang.length > 0) {
                const id = 'TRX-' + Date.now().toString().slice(-6);
                
                const newTransaction = {
                    id: id,
                    tanggal: getCurrentDate(),
                    total: Number(totalBayar),
                    items: keranjang.map(item => `${item.nama} (x${item.qty})`).join(', '),
                    kasir: 'Admin Utama'
                };
                
                // Simpan ke Firebase
                saveTransaksiToFirebase(newTransaction).then(() => {
                    alert(`Transaksi ${id} sebesar ${formatRupiah(Number(totalBayar))} berhasil diproses!`);
                    keranjang = [];
                    updateKeranjangUI();
                }).catch((error) => {
                    alert('Gagal menyimpan transaksi: ' + error.message);
                });
            } else {
                alert("Keranjang masih kosong.");
            }
        }

        function tampilkanRiwayat() {
            const riwayatBody = document.querySelector('#riwayat-transaksi-body');
            const messageEl = document.getElementById('riwayat-kosong-message');
            
            riwayatBody.innerHTML = '';
            
            // Filter transaksi hari ini
            const today = getCurrentDate();
            const transaksiHariIni = riwayatTransaksi.filter(t => t.tanggal === today);
            
            if (transaksiHariIni.length === 0) {
                messageEl.style.display = 'block';
                return;
            }
            
            messageEl.style.display = 'none';

            transaksiHariIni.slice(0, 10).forEach(t => {
                const row = `
                    <tr>
                        <td>${t.id}</td>
                        <td>${t.tanggal}</td>
                        <td>${t.items.substring(0, 30)}...</td>
                        <td>${formatRupiah(t.total)}</td>
                        <td>${t.kasir}</td>
                    </tr>
                `;
                riwayatBody.innerHTML += row;
            });
        }

        // --- FUNGSI LAPORAN KEUANGAN DINAMIS ---
        function updateLaporanKeuangan() {
            const today = getCurrentDate();
            const transaksiHariIni = riwayatTransaksi.filter(t => t.tanggal === today);
            const totalPemasukan = transaksiHariIni.reduce((sum, t) => sum + t.total, 0);
            
            const jualLele = totalPemasukan * 0.85;
            const jualMinuman = totalPemasukan * 0.15;
            
            const totalPengeluaran = pengeluaranDetail.bahanBaku + pengeluaranDetail.gas + pengeluaranDetail.operasional;
            const labaBersih = totalPemasukan - totalPengeluaran;
            const margin = (totalPemasukan > 0) ? (labaBersih / totalPemasukan) * 100 : 0;
            
            document.getElementById('laporan-tanggal').textContent = getCurrentDate();
            document.getElementById('laporan-jual-lele').textContent = formatRupiah(jualLele);
            document.getElementById('laporan-jual-minuman').textContent = formatRupiah(jualMinuman);
            document.getElementById('laporan-total-pemasukan').textContent = formatRupiah(totalPemasukan);
            
            document.getElementById('laporan-pengeluaran-bahan').textContent = formatRupiah(pengeluaranDetail.bahanBaku);
            document.getElementById('laporan-pengeluaran-gas').textContent = formatRupiah(pengeluaranDetail.gas);
            document.getElementById('laporan-pengeluaran-operasional').textContent = formatRupiah(pengeluaranDetail.operasional);
            document.getElementById('laporan-total-pengeluaran').textContent = formatRupiah(totalPengeluaran);
            
            document.getElementById('laporan-laba-bersih').textContent = formatRupiah(labaBersih);
            document.getElementById('laporan-margin-row').innerHTML = `Margin: <strong>${margin.toFixed(2)}%</strong>`;
        }

        // --- FUNGSI NAVIGASI DAN LOGIN ---
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.sidebar .menu a').forEach(link => link.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            if (document.getElementById(`nav-${pageId}`)) {
                document.getElementById(`nav-${pageId}`).classList.add('active');
            }
            
            if (pageId === 'dashboard') {
                renderLineChart();
                renderPieChart();
                updateDashboardSummary();
                updateStockAlert();
            }
            if (pageId === 'laporan') {
                renderBarChart();
                updateLaporanKeuangan();
            }
            if (pageId === 'transaksi') {
                updateKeranjangUI();
                tampilkanRiwayat();
            }
            if (pageId === 'inventori') {
                updateInventoryTable();
            }
        }

        function doLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username-input').value;
            const password = document.getElementById('password-input').value;

            if (username === 'admin' && password === '123') {
                document.getElementById('login').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                showPage('dashboard');
            } else {
                alert('Username atau Password salah!');
            }
        }

        function doLogout() {
            document.getElementById('login').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
        }

        // --- INISIALISASI DATA FIREBASE (JIKA BELUM ADA) ---
        function initializeFirebaseData() {
            if (!database) {
                console.error('Database not initialized');
                return;
            }
            
            // Cek apakah data inventory sudah ada
            database.ref('inventory').once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    console.log('Initializing default inventory data...');
                    // Inisialisasi data inventory default
                    const defaultInventory = {
                        item1: {
                            nama: 'Lele Segar',
                            stok: 15,
                            satuan: 'Kg',
                            min: 20
                        },
                        item2: {
                            nama: 'Minyak Goreng',
                            stok: 5,
                            satuan: 'Liter',
                            min: 3
                        },
                        item3: {
                            nama: 'Bumbu Pecel',
                            stok: 3,
                            satuan: 'Kg',
                            min: 2
                        },
                        item4: {
                            nama: 'Nasi',
                            stok: 80,
                            satuan: 'Porsi',
                            min: 50
                        },
                        item5: {
                            nama: 'Sambal',
                            stok: 2,
                            satuan: 'Kg',
                            min: 3
                        },
                        item6: {
                            nama: 'Lalapan',
                            stok: 40,
                            satuan: 'Porsi',
                            min: 30
                        }
                    };
                    
                    database.ref('inventory').set(defaultInventory)
                        .then(() => {
                            console.log('Data inventory default berhasil dibuat');
                            alert('Data inventory berhasil diinisialisasi!');
                        })
                        .catch((error) => {
                            console.error('Error membuat data inventory:', error);
                            alert('Error membuat data inventory: ' + error.message);
                        });
                } else {
                    console.log('Inventory data already exists');
                }
            }).catch((error) => {
                console.error('Error checking inventory:', error);
            });
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', doLogin);

            const loginPage = document.getElementById('login');
            const appContainer = document.getElementById('app-container');

            loginPage.classList.add('active');
            appContainer.style.display = 'none';
            
            // Tunggu Firebase siap
            setTimeout(() => {
                if (database) {
                    // Inisialisasi data Firebase
                    initializeFirebaseData();
                    
                    // Load data dari Firebase
                    loadInventoryFromFirebase();
                    loadTransaksiFromFirebase();
                    
                    updateDashboardSummary();
                    tampilkanRiwayat();
                    updateLaporanKeuangan();
                } else {
                    console.error('Database not ready');
                    alert('Firebase tidak dapat terhubung. Periksa konfigurasi atau koneksi internet Anda.');
                }
            }, 1000);
            
            // Event listener untuk dropdown nama bahan
            const namaBahanSelect = document.getElementById('namaBahan');
            const satuanInput = document.getElementById('satuan');
            
            namaBahanSelect.addEventListener('change', (e) => {
                const selectedOption = e.target.options[e.target.selectedIndex];
                if (selectedOption.dataset.satuan) {
                    satuanInput.value = selectedOption.dataset.satuan;
                } else {
                    satuanInput.value = '';
                }
            });
            
            // Form submit untuk input stok
            const form = document.getElementById('inputStokForm');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (!database) {
                    showMessage('Database tidak terhubung!', 'error');
                    return;
                }
                
                const itemId = document.getElementById('namaBahan').value;
                const jumlah = parseInt(document.getElementById('jumlahStok').value);
                const jenis = document.getElementById('jenisTransaksi').value;
                
                if (!itemId) {
                    showMessage('Pilih bahan terlebih dahulu!', 'error');
                    return;
                }
                
                const item = inventoryData.find(i => i.id === itemId);
                if (!item) {
                    showMessage('Bahan tidak ditemukan!', 'error');
                    return;
                }
                
                let newStok = item.stok;
                if (jenis === 'tambah') {
                    newStok += jumlah;
                } else {
                    newStok -= jumlah;
                    if (newStok < 0) {
                        showMessage('Stok tidak boleh kurang dari 0!', 'error');
                        return;
                    }
                }
                
                console.log(`Updating stock for ${item.nama}: ${item.stok} -> ${newStok}`);
                
                // Update ke Firebase
                database.ref('inventory/' + itemId).update({
                    stok: newStok
                }).then(() => {
                    showMessage(`Stok ${item.nama} berhasil diupdate! (${item.stok} -> ${newStok})`, 'success');
                    form.reset();
                    document.getElementById('satuan').value = '';
                    
                    // Kembali ke daftar stok setelah 2 detik
                    setTimeout(() => {
                        toggleInputStok();
                    }, 2000);
                }).catch((error) => {
                    console.error('Error updating stock:', error);
                    showMessage('Gagal mengupdate stok: ' + error.message, 'error');
                });
            });
            
            // Event listener untuk tombol Export Excel (CSV)
            const exportButton = document.getElementById('export-excel-button');
            if (exportButton) {
                exportButton.addEventListener('click', exportLabaRugiToCSV);
            }
        });
    </script>
</body>
</html>
